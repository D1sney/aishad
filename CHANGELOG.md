# Changelog

## Полный data.txt в системном промпте (Latest)

### Что изменилось:
- Убран RAG: больше нет embeddings и поиска по FAISS.
- Весь `data/data.txt` добавляется в системный промпт для ответов.
- Команды `/set_chunk_size` и `/set_top_k` удалены, `/config` показывает путь к файлу и модель.
- `config.json` хранит только `data_file` и список администраторов.
- Удалены лишние зависимости (`sentence-transformers`, `faiss-cpu`, `numpy`).

### Файлы:
- [llm/openrouter_client.py](llm/openrouter_client.py) — новый системный промпт с полным data.txt
- [bot/handlers.py](bot/handlers.py) — удалены RAG-команды, обновлен `/config`
- [bot/config.py](bot/config.py) — упрощенная конфигурация
- [requirements.txt](requirements.txt) — только необходимые пакеты
- [README.md](README.md), [DATA_MANAGEMENT.md](DATA_MANAGEMENT.md) — обновленная документация

---

## Управление data.txt + Русская модель embeddings

### Что добавлено:

#### 1. Управление базой знаний через Telegram:
- `/get_data` - скачать текущий data.txt
- Загрузка нового data.txt - просто отправь .txt файл боту
- Автоматическое создание резервных копий (data.txt.backup)
- Поддержка любых имен файлов - все сохраняется как data.txt

#### 2. Русскоязычная модель embeddings:
- Заменена `all-MiniLM-L6-v2` на `cointegrated/rubert-tiny2`
- Специально обучена для русского языка
- Лучше понимает семантику русских текстов
- Улучшает качество поиска по базе знаний

#### 3. Процесс обновления базы:
1. Админ использует `/get_data` для скачивания
2. Редактирует файл локально
3. Отправляет обратно боту
4. Бот сохраняет + создает backup
5. Админ перезапускает бота
6. Embeddings пересоздаются автоматически

### Файлы:
- [DATA_MANAGEMENT.md](DATA_MANAGEMENT.md) - подробная инструкция
- [bot/handlers.py](bot/handlers.py#L186-L280) - новые хендлеры
- [config.json](config.json) - обновлена модель

---

## Добавлена система конфигурации

### Что добавлено:

#### 1. Файл конфигурации `config.json`
- Хранит настройки RAG (chunk_size, top_k, embedding_model)
- Хранит список администраторов
- Автоматически загружается при запуске
- Сохраняется при изменении настроек

#### 2. Админ-команды в Telegram боте:
- `/myid` - узнать свой Telegram ID (для всех)
- `/config` - просмотр текущих настроек RAG (только админы)
- `/set_chunk_size <число>` - изменить размер чанков (только админы, требует перезапуска)
- `/set_top_k <число>` - изменить количество чанков (только админы, применяется сразу)
- `/add_admin <user_id>` - добавить нового администратора (только админы)

#### 3. Улучшенное логирование:
- Показывает какие chunks находит RAG
- Показывает контекст, отправляемый в LLM
- Показывает сгенерированный ответ

#### 4. Динамическая конфигурация:
- `top_k` меняется без перезапуска бота
- `chunk_size` требует перезапуска (нужно переиндексировать данные)
- Настройки сохраняются между перезапусками

### Структура файлов:

```
config.json              # Настройки RAG и администраторы
bot/config.py           # Загрузка и сохранение конфигурации
bot/handlers.py         # Обработчики команд (включая админские)
SETUP_GUIDE.md          # Быстрый старт
CHANGELOG.md            # Этот файл
```

### Как использовать:

1. Запусти бота: `python main.py`
2. Узнай свой ID: отправь `/myid` боту
3. Добавь себя в админы в `config.json`
4. Перезапусти бота
5. Управляй настройками через Telegram!

### Рекомендуемые настройки:

Для небольшой базы знаний (2-10 страниц):
```json
{
  "rag": {
    "chunk_size": 400,
    "top_k": 5
  }
}
```

Для большой базы знаний (>20 страниц):
```json
{
  "rag": {
    "chunk_size": 600,
    "top_k": 7
  }
}
```

---

## Исходная версия

### Функционал:
- Telegram бот на aiogram3
- RAG на базе sentence-transformers + FAISS
- LLM: Grok через OpenRouter
- Базовые команды: /start, /help
- Ответы на вопросы пользователей
